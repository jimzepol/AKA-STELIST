<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover">
    <title>SETLIST PWA - BY JIM LOPEZ</title>
    
    <!-- Meta Tags PWA pour iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SETLIST">
    
    <!-- Nouvelle Icône PWA (SVG Stylisé : Vinyl + Note Indigo) -->
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj4KICA8cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgcng9IjEyOCIgZmlsbD0iIzAwMCIvPgogIDxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTkyIiBmaWxsPSIjMWExYTFlIiBzdHJva2U9IiM0ZjQ2ZTUiIHN0cm9rZS13aWR0aD0iOCIvPgogIDxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTYwIiBmaWxsPSJub25lIiBzdHJva2U9IiMzZjNmNDYiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWRhc2hhcnJheT0iNCw4Ii8+CiAgPGNpcmNsZSBjeD0iMjU2IiBjeT0iMjU2IiByPSIxMjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzNmM2Y0NiIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtZGFzaGFycmF5PSI2LDEwIi8+CiAgPGNpcmNsZSBjeD0iMjU2IiBjeT0iMjU2IiByPSI0MCIgZmlsbD0iIzRmNDZlNSIvPgogIDxwYXRoIGQ9Ik0yOTYgMjE2IFYxNDAgSDE5NiBWMTU2IEgyODAgVjIxNiBaIiBmaWxsPSJ3aGl0ZSIvPgogIDxjaXJjbGUgY3g9IjE5NiIgY3k9IjI0MCIgcj0iMjQiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPg==">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj4KICA8cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgcng9IjEyOCIgZmlsbD0iIzAwMCIvPgogIDxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTkyIiBmaWxsPSIjMWExYTFlIiBzdHJva2U9IiM0ZjQ2ZTUiIHN0cm9rZS13aWR0aD0iOCIvPgogIDxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTYwIiBmaWxsPSJub25lIiBzdHJva2U9IiMzZjNmNDYiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWRhc2hhcnJheT0iNCw4Ii8+CiAgPGNpcmNsZSBjeD0iMjU2IiBjeT0iMjU2IiByPSIxMjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzNmM2Y0NiIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtZGFzaGFycmF5PSI2LDEwIi8+CiAgPGNpcmNsZSBjeD0iMjU2IiBjeT0iMjU2IiByPSI0MCIgZmlsbD0iIzRmNDZlNSIvPgogIDxwYXRoIGQ9Ik0yOTYgMjE2IFYxNDAgSDE5NiBWMTU2IEgyODAgVjIxNiBaIiBmaWxsPSJ3aGl0ZSIvPgogIDxjaXJjbGUgY3g9IjE5NiIgY3k9IjI0MCIgcj0iMjQiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPg==">

    <meta name="theme-color" content="#000000">

    <!-- Scripts Externes -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            background-color: #000000;
            color: #ffffff;
            margin: 0;
            font-family: ui-sans-serif, system-ui, -apple-system, sans-serif;
            overscroll-behavior: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        .pt-safe { padding-top: env(safe-area-inset-top); }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }

        @keyframes pulse-custom {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        .animate-pulse-custom { animation: pulse-custom 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite; }

        input::placeholder { color: #3f3f46; text-transform: uppercase; }
        select { -webkit-appearance: none; appearance: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        /**
         * Système d'icônes intégré (Failsafe)
         */
        const Icons = {
            plus: <path d="M12 5v14M5 12h14" />,
            x: <path d="M18 6L6 18M6 6l12 12" />,
            trash: <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2" />,
            play: <path d="m5 3 14 9-14 9V3z" fill="currentColor" />,
            settings: (
                <React.Fragment>
                    <path d="M12.22 2h-.44a2 2 0 00-2 2v.18a2 2 0 01-1 1.73l-.43.25a2 2 0 01-2 0l-.15-.08a2 2 0 00-2.73.73l-.22.38a2 2 0 00.73 2.73l.15.1a2 2 0 011 1.72v.51a2 2 0 01-1 1.74l-.15.09a2 2 0 00-.73 2.73l.22.38a2 2 0 002.73.73l.15-.08a2 2 0 012 0l.43.25a2 2 0 011 1.73V20a2 2 0 002 2h.44a2 2 0 002-2v-.18a2 2 0 011-1.73l.43-.25a2 2 0 012 0l.15.08a2 2 0 002.73-.73l.22-.39a2 2 0 00-.73-2.73l-.15-.1a2 2 0 01-1-1.72v-.51a2 2 0 011-1.74l.15-.09a2 2 0 00.73-2.73l-.22-.38a2 2 0 00-2.73-.73l-.15.08a2 2 0 01-2 0l-.43-.25a2 2 0 01-1-1.73V4a2 2 0 00-2-2z"/>
                    <circle cx="12" cy="12" r="3"/>
                </React.Fragment>
            ),
            music: (
                <React.Fragment>
                    <path d="M9 18V5l12-2v13"/>
                    <circle cx="6" cy="18" r="3"/>
                    <circle cx="18" cy="16" r="3"/>
                </React.Fragment>
            ),
            list: <path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01" />,
            chevronUp: <path d="m18 15-6-6-6 6" />,
            chevronDown: <path d="m6 9 6 6 6-6" />,
            grip: (
                <React.Fragment>
                    <circle cx="9" cy="5" r="1"/><circle cx="9" cy="12" r="1"/><circle cx="9" cy="19" r="1"/>
                    <circle cx="15" cy="5" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="15" cy="19" r="1"/>
                </React.Fragment>
            ),
            arrowLeft: <path d="m12 19-7-7 7-7M19 12H5" />,
            share: <path d="M4 12v8a2 2 0 002 2h12a2 2 0 002-2v-8M16 6l-4-4-4 4M12 2v13" />,
            download: <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" />,
            check: <path d="m20 6-11 11-5-5" />,
            alert: <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0zM12 9v4M12 17h.01" />
        };

        const Icon = ({ name, size = 24, className = "", color = "white", strokeWidth = 2.5 }) => (
            <svg
                width={size}
                height={size}
                viewBox="0 0 24 24"
                fill="none"
                stroke={color}
                strokeWidth={strokeWidth}
                strokeLinecap="round"
                strokeLinejoin="round"
                className={className}
            >
                {Icons[name] || Icons.music}
            </svg>
        );

        function App() {
            const [appState, setAppState] = useState('welcome'); 
            const [artistName, setArtistName] = useState(localStorage.getItem('artistName') || '');
            const [songs, setSongs] = useState(() => JSON.parse(localStorage.getItem('songs') || '[]'));
            const [setlists, setSetlists] = useState(() => JSON.parse(localStorage.getItem('setlists') || '[]'));
            const [settings, setSettings] = useState(() => JSON.parse(localStorage.getItem('settings') || '{"showNumbers":true,"descOrder":false}'));
            
            const [activeSetlist, setActiveSetlist] = useState(null);
            const [currentShowIndex, setCurrentShowIndex] = useState(0);
            const [sharedPreview, setSharedPreview] = useState(null);
            const [modal, setModal] = useState({ type: null, data: null }); 
            const [modalInput, setModalInput] = useState('');

            // Manifeste PWA dynamique avec la nouvelle icône
            useEffect(() => {
                const iconUrl = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj4KICA8cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgcng9IjEyOCIgZmlsbD0iIzAwMCIvPgogIDxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTkyIiBmaWxsPSIjMWExYTFlIiBzdHJva2U9IiM0ZjQ2ZTUiIHN0cm9rZS13aWR0aD0iOCIvPgogIDxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTYwIiBmaWxsPSJub25lIiBzdHJva2U9IiMzZjNmNDYiIHN0cm9rZS13aWR0aD0iIjIgc3Ryb2tlLWRhc2hhcnJheT0iNCw4Ii8+CiAgPGNpcmNsZSBjeD0iMjU2IiBjeT0iMjU2IiByPSIxMjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzNmM2Y0NiIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtZGFzaGFycmF5PSI2LDEwIi8+CiAgPGNpcmNsZSBjeD0iMjU2IiBjeT0iMjU2IiByPSI0MCIgZmlsbD0iIzRmNDZlNSIvPgogIDxwYXRoIGQ9Ik0yOTYgMjE2IFYxNDAgSDE5NiBWMTU2IEgyODAgVjIxNiBaIiBmaWxsPSJ3aGl0ZSIvPgogIDxjaXJjbGUgY3g9IjE5NiIgY3k9IjI0MCIgcj0iMjQiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPg==";
                const manifest = {
                    name: "Setlist PWA",
                    short_name: "Setlist",
                    start_url: ".",
                    display: "standalone",
                    background_color: "#000000",
                    theme_color: "#000000",
                    icons: [{ src: iconUrl, sizes: "512x512", type: "image/svg+xml", purpose: "any maskable" }]
                };
                const stringManifest = JSON.stringify(manifest);
                const blob = new Blob([stringManifest], {type: 'application/json'});
                const manifestURL = URL.createObjectURL(blob);
                const link = document.createElement('link');
                link.rel = 'manifest';
                link.href = manifestURL;
                document.head.appendChild(link);
            }, []);

            useEffect(() => { localStorage.setItem('artistName', artistName); }, [artistName]);
            useEffect(() => { localStorage.setItem('songs', JSON.stringify(songs)); }, [songs]);
            useEffect(() => { localStorage.setItem('setlists', JSON.stringify(setlists)); }, [setlists]);
            useEffect(() => { localStorage.setItem('settings', JSON.stringify(settings)); }, [settings]);

            const loadSharedData = (raw) => {
                try {
                    const decoded = JSON.parse(atob(raw));
                    setSharedPreview(decoded);
                    setAppState('share_preview');
                } catch(e) { alert("Lien invalide."); }
            };

            useEffect(() => {
                if (artistName && appState === 'welcome') setAppState('setlists');
                const urlParams = new URLSearchParams(window.location.search);
                const shareData = urlParams.get('s_data');
                if (shareData) loadSharedData(shareData);
            }, []);

            const saveArtist = () => {
                if (!modalInput.trim()) return;
                setArtistName(modalInput.toUpperCase());
                setAppState('library');
                setModalInput('');
            };

            const addSong = (title) => {
                if (!title || songs.length >= 100) return;
                setSongs([...songs, { id: Date.now() + Math.random(), title: title.toUpperCase() }]);
            };

            const deleteSong = (id) => {
                setSongs(prev => prev.filter(s => s.id !== id));
                setSetlists(prev => prev.map(sl => ({ ...sl, songIds: sl.songIds.filter(sid => sid !== id) })));
            };

            const createSetlist = (name) => {
                if (!name) return;
                setSetlists([...setlists, { id: Date.now(), name: name.toUpperCase(), songIds: [] }]);
                setModal({ type: null });
                setModalInput('');
            };

            const addSongToSl = (slId, songId) => {
                setSetlists(prev => prev.map(s => s.id === slId ? { ...s, songIds: [...s.songIds, songId] } : s));
            };

            const moveInSl = (slId, from, to) => {
                setSetlists(prev => prev.map(sl => {
                    if (sl.id !== slId) return sl;
                    const ids = [...sl.songIds];
                    const [item] = ids.splice(from, 1);
                    ids.splice(to, 0, item);
                    return { ...sl, songIds: ids };
                }));
            };

            const removeFromSetlist = (slId, index) => {
                setSetlists(prev => prev.map(sl => {
                    if (sl.id !== slId) return sl;
                    return { ...sl, songIds: sl.songIds.filter((_, i) => i !== index) };
                }));
            };

            const shareSetlist = (sl) => {
                const slSongs = sl.songIds.map(id => songs.find(s => s.id === id)?.title).filter(Boolean);
                const data = btoa(JSON.stringify({ artist: artistName, name: sl.name, songs: slSongs }));
                const url = window.location.origin + window.location.pathname + "?s_data=" + data;
                const el = document.createElement('textarea');
                el.value = url; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el);
                setModal({ type: 'shareSuccess', data: url });
            };

            const importSetlist = () => {
                if (!sharedPreview) return;
                const time = Date.now();
                const newSongs = sharedPreview.songs.map((t, i) => ({ id: time + i + Math.random(), title: t.toUpperCase() }));
                setSongs(prev => [...prev, ...newSongs]);
                setSetlists(prev => [...prev, { id: time + 999, name: "IMPORT: " + sharedPreview.name, songIds: newSongs.map(s => s.id) }]);
                setSharedPreview(null); setAppState('setlists');
                window.history.replaceState({}, '', window.location.pathname);
            };

            const Signature = () => (
                <div className="text-center py-6 text-[10px] text-zinc-600 font-black uppercase tracking-[0.4em]">By Jim Lopez</div>
            );

            const Modal = () => {
                if (!modal.type) return null;
                return (
                    <div className="fixed inset-0 bg-black/95 backdrop-blur-xl z-[999] flex items-center justify-center p-6 uppercase font-bold text-white no-tap">
                        <div className="bg-zinc-900 border border-zinc-800 w-full max-w-sm rounded-[2.5rem] p-8 space-y-6 shadow-2xl">
                            <div className="flex flex-col items-center text-center space-y-4">
                                {modal.type === 'addSetlist' && (
                                    <>
                                        <Icon name="plus" size={56} className="text-indigo-500" />
                                        <h3 className="text-xl tracking-tighter">NOUVELLE SETLIST</h3>
                                        <input 
                                            autoFocus type="text" placeholder="NOM"
                                            className="w-full p-5 bg-zinc-950 border border-zinc-800 rounded-2xl outline-none focus:border-indigo-500 text-center uppercase font-bold text-xl text-white"
                                            value={modalInput} onChange={e => setModalInput(e.target.value)}
                                            onKeyDown={e => e.key === 'Enter' && createSetlist(modalInput)}
                                        />
                                    </>
                                )}
                                {modal.type === 'manualImport' && (
                                    <>
                                        <Icon name="download" size={56} className="text-indigo-500" />
                                        <h3 className="text-xl tracking-tighter">IMPORTER UN LIEN</h3>
                                        <input 
                                            autoFocus type="text" placeholder="COLLER LE LIEN ICI"
                                            className="w-full p-5 bg-zinc-950 border border-zinc-800 rounded-2xl outline-none focus:border-indigo-500 text-center uppercase font-bold text-xs text-white"
                                            value={modalInput} onChange={e => setModalInput(e.target.value)}
                                        />
                                    </>
                                )}
                                {modal.type === 'shareSuccess' && (
                                    <>
                                        <Icon name="check" size={56} className="text-green-500" />
                                        <h3 className="text-xl text-green-500">LIEN COPIÉ !</h3>
                                        <p className="text-[10px] text-zinc-500 font-normal leading-relaxed tracking-widest uppercase">ENVOYEZ CE LIEN À VOTRE CONTACT POUR PARTAGER LA SETLIST.</p>
                                    </>
                                )}
                                {modal.type === 'confirmExit' && (
                                    <>
                                        <Icon name="alert" size={56} className="text-yellow-500" />
                                        <h3 className="text-xl">QUITTER SHOW TIME ?</h3>
                                    </>
                                )}
                                {modal.type === 'confirmDelete' && (
                                    <>
                                        <Icon name="trash" size={56} className="text-red-500" />
                                        <h3 className="text-xl text-red-500">TOUT EFFACER ?</h3>
                                    </>
                                )}
                            </div>
                            <div className="flex gap-3">
                                <button onClick={() => {setModal({type:null}); setModalInput('');}} className="flex-1 py-5 bg-zinc-800 rounded-2xl active:scale-95 transition-transform text-white">ANNULER</button>
                                {modal.type !== 'shareSuccess' && (
                                    <button 
                                        onClick={() => {
                                            if(modal.type==='addSetlist') createSetlist(modalInput);
                                            if(modal.type==='manualImport') {
                                                try {
                                                    const url = new URL(modalInput);
                                                    const data = url.searchParams.get('s_data');
                                                    if(data) { loadSharedData(data); setModal({type:null}); setModalInput(''); }
                                                    else alert("Lien invalide.");
                                                } catch(e) { alert("Lien invalide."); }
                                            }
                                            if(modal.type==='confirmExit') { setAppState('setlists'); setModal({type:null}); }
                                            if(modal.type==='confirmDelete') { localStorage.clear(); window.location.reload(); }
                                        }}
                                        className={`flex-1 py-5 rounded-2xl active:scale-95 transition-transform shadow-lg text-white ${modal.type==='confirmDelete' ? 'bg-red-600 shadow-red-900/20' : 'bg-indigo-600 shadow-indigo-900/20'}`}
                                    >CONFIRMER</button>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            if (appState === 'welcome') {
                return (
                    <div className="min-h-screen flex flex-col p-8 items-center justify-center text-center uppercase font-black text-white bg-black">
                        <Icon name="music" size={80} className="mb-10 text-indigo-500" />
                        <h1 className="text-4xl mb-4 tracking-tighter">BIENVENUE</h1>
                        <p className="text-zinc-500 mb-14 max-w-xs text-sm tracking-widest leading-relaxed">RENSEIGNEZ VOTRE NOM DE SCÈNE POUR COMMENCER</p>
                        <div className="w-full max-w-sm space-y-4">
                            <input 
                                type="text" placeholder="NOM (ARTISTE / GROUPE)" 
                                className="w-full p-6 bg-zinc-900 border-2 border-zinc-800 rounded-[2.5rem] outline-none text-center font-black uppercase text-xl focus:border-indigo-500 text-white"
                                value={modalInput} onChange={e => setModalInput(e.target.value)}
                            />
                            <button onClick={saveArtist} className="w-full py-6 bg-indigo-600 rounded-[2.5rem] font-black text-2xl shadow-2xl active:scale-95 transition-transform uppercase tracking-widest text-white">COMMENCER</button>
                        </div>
                        <div className="mt-10"><Signature /></div>
                    </div>
                );
            }

            if (appState === 'share_preview' && sharedPreview) {
                return (
                    <div className="min-h-screen p-6 uppercase font-bold flex flex-col text-white bg-black">
                        <div className="flex-1 flex flex-col max-w-md mx-auto w-full pt-12 space-y-10">
                            <div className="text-center">
                                <Icon name="share" size={64} className="mx-auto text-indigo-500 mb-6" />
                                <h1 className="text-3xl font-black tracking-tighter leading-none">{sharedPreview.name}</h1>
                                <p className="text-zinc-500 tracking-widest text-[10px] mt-4 opacity-60 italic uppercase">PARTAGÉ PAR {sharedPreview.artist}</p>
                            </div>
                            <div className="bg-zinc-900 border border-zinc-800 rounded-[2.5rem] p-6 space-y-3 overflow-y-auto max-h-[50vh] shadow-2xl">
                                {sharedPreview.songs && sharedPreview.songs.map((t, i) => (
                                    <div key={i} className="flex gap-4 items-center p-4 bg-zinc-950 rounded-2xl border border-zinc-800/40">
                                        <span className="text-[10px] font-mono text-zinc-700">{(i+1).toString().padStart(2,'0')}</span>
                                        <span className="text-sm font-black tracking-tight">{t}</span>
                                    </div>
                                ))}
                            </div>
                            <button onClick={importSetlist} className="w-full py-6 bg-indigo-600 rounded-[2.5rem] font-black text-xl flex items-center justify-center gap-3 active:scale-95 transition-transform shadow-xl uppercase tracking-tighter text-white">
                                <Icon name="download" size={24} /> IMPORTER LA SETLIST
                            </button>
                        </div>
                        <Signature />
                    </div>
                );
            }

            if (appState === 'showtime' && activeSetlist) {
                const songIds = settings.descOrder ? [...activeSetlist.songIds].reverse() : activeSetlist.songIds;
                const currentSong = songs.find(s => s.id === songIds[currentShowIndex]);
                const isLast = currentShowIndex === songIds.length - 1;
                const isPenultimate = currentShowIndex === songIds.length - 2;
                const next = () => currentShowIndex < songIds.length - 1 && setCurrentShowIndex(c => c + 1);
                const prev = () => currentShowIndex > 0 && setCurrentShowIndex(c => c - 1);
                const displayNum = settings.descOrder ? (songIds.length - currentShowIndex) : (currentShowIndex + 1);

                return (
                    <div className="fixed inset-0 bg-black text-white flex flex-col items-center justify-center z-[500] overflow-hidden touch-none font-black uppercase">
                        <Modal />
                        <button onClick={() => setModal({type:'confirmExit'})} className="absolute top-6 right-6 p-4 text-zinc-800 hover:text-white z-20 active:scale-90 transition-transform">
                            <Icon name="x" size={56} />
                        </button>
                        
                        <div className="absolute left-6 flex flex-col gap-10 z-10 opacity-20 hover:opacity-100 transition-opacity">
                            <button onClick={prev} className={`p-5 rounded-full bg-zinc-900/40 border border-zinc-800/30 text-white ${currentShowIndex === 0 ? 'invisible' : ''}`}>
                                <Icon name="chevronUp" size={64} strokeWidth={4} />
                            </button>
                            <button onClick={next} className={`p-5 rounded-full bg-zinc-900/40 border border-zinc-800/30 text-white ${isLast ? 'invisible' : ''}`}>
                                <Icon name="chevronDown" size={64} strokeWidth={4} />
                            </button>
                        </div>

                        <div className="w-full h-full flex flex-col items-center justify-center px-12 text-center select-none" onClick={e => e.clientX > window.innerWidth/2 ? next() : prev()}>
                            {settings.showNumbers && (
                                <div className="text-5xl text-white mb-10 font-mono tracking-[0.5em] font-black opacity-80">
                                    #{displayNum.toString().padStart(2,'0')}
                                </div>
                            )}
                            <h2 className={`text-6xl md:text-[15rem] font-black tracking-tighter leading-[0.8] drop-shadow-[0_10px_20px_rgba(0,0,0,1)] ${isLast ? 'text-red-600 animate-pulse-custom' : isPenultimate ? 'text-yellow-400' : 'text-white'}`}>
                                {currentSong?.title || "???"}
                            </h2>
                            <div className="mt-20 text-zinc-900 text-xl tracking-[0.8em] font-black opacity-30 uppercase">{currentShowIndex+1} / {songIds.length}</div>
                        </div>
                        <div className="absolute bottom-4"><Signature /></div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen flex flex-col max-w-md mx-auto border-x border-zinc-900 bg-black text-white relative shadow-2xl overflow-hidden pt-safe pb-safe no-tap">
                    <Modal />
                    <header className="p-8 border-b border-zinc-900/60 flex justify-between items-center bg-black/80 backdrop-blur-2xl sticky top-0 z-10">
                        <div className="flex flex-col">
                            <h1 className="text-2xl font-black uppercase tracking-tighter leading-none">{artistName}</h1>
                            <p className="text-[9px] text-zinc-600 uppercase tracking-[0.5em] font-black italic mt-2 opacity-60">By Jim Lopez</p>
                        </div>
                        <button onClick={() => setAppState('settings')} className="p-3 bg-zinc-900 rounded-2xl text-zinc-400 border border-zinc-800 active:scale-90 transition-transform">
                            <Icon name="settings" size={24} />
                        </button>
                    </header>

                    <main className="flex-1 overflow-y-auto p-6 space-y-10 font-bold pb-24">
                        <div className="flex bg-zinc-900/50 p-2 rounded-[2.2rem] border border-zinc-900 shadow-inner">
                            <button onClick={() => setAppState('setlists')} className={`flex-1 py-4 rounded-[1.8rem] text-[10px] uppercase font-black tracking-widest transition-all duration-300 ${appState === 'setlists' ? 'bg-indigo-600 text-white shadow-xl shadow-indigo-900/40' : 'text-zinc-700'}`}>Setlists</button>
                            <button onClick={() => setAppState('library')} className={`flex-1 py-4 rounded-[1.8rem] text-[10px] uppercase font-black tracking-widest transition-all duration-300 ${appState === 'library' ? 'bg-indigo-600 text-white shadow-xl shadow-indigo-900/40' : 'text-zinc-700'}`}>Bibliothèque</button>
                        </div>

                        {appState === 'library' && (
                            <div className="space-y-6">
                                <h2 className="text-xl font-black uppercase px-2 tracking-tight">MES TITRES ({songs.length}/100)</h2>
                                <div className="flex gap-3">
                                    <input id="songIn" type="text" placeholder="NOUVEAU TITRE..." className="flex-1 p-5 bg-zinc-900 border border-zinc-800 rounded-2xl outline-none uppercase font-black focus:border-indigo-500 text-lg text-white" onKeyDown={e => e.key==='Enter' && (addSong(e.target.value), e.target.value='')} />
                                    <button onClick={() => {const i=document.getElementById('songIn'); if(i.value) addSong(i.value); i.value=''}} className="p-5 bg-indigo-600 rounded-2xl active:scale-95 shadow-lg text-white">
                                        <Icon name="plus" size={32} strokeWidth={4} />
                                    </button>
                                </div>
                                <div className="space-y-3">
                                    {[...songs].reverse().map(s => (
                                        <div key={s.id} className="p-6 bg-zinc-900/40 rounded-3xl flex justify-between items-center border border-zinc-900 hover:border-zinc-800 transition-all">
                                            <span className="font-black uppercase text-zinc-200 tracking-tight text-lg truncate pr-4">{s.title}</span>
                                            <button onClick={() => deleteSong(s.id)} className="text-zinc-800 hover:text-red-500 transition-colors active:scale-75 p-2 shrink-0">
                                                <Icon name="trash" size={24} />
                                            </button>
                                        </div>
                                    ))}
                                    {songs.length === 0 && <p className="text-center text-zinc-900 py-24 uppercase tracking-[0.5em] text-[11px] font-black opacity-20 italic">VOTRE BIBLIOTHÈQUE EST VIDE</p>}
                                </div>
                            </div>
                        )}

                        {appState === 'setlists' && (
                            <div className="space-y-8">
                                <div className="flex justify-between items-center px-2 gap-2">
                                    <h2 className="text-xl font-black uppercase tracking-tight flex-1">MES SETLISTS</h2>
                                    <button onClick={() => setModal({type:'manualImport'})} className="p-3 bg-zinc-900 border border-zinc-800 rounded-xl active:scale-90 transition-transform">
                                        <Icon name="download" size={20} />
                                    </button>
                                    <button onClick={() => setModal({type:'addSetlist'})} className="p-4 bg-indigo-600 text-white rounded-2xl active:scale-90 transition-transform shadow-xl">
                                        <Icon name="plus" size={28} strokeWidth={4} />
                                    </button>
                                </div>
                                {setlists.map(sl => (
                                    <div key={sl.id} className="bg-zinc-900/30 border border-zinc-900 rounded-[3.2rem] overflow-hidden shadow-2xl">
                                        <div className="p-8 flex justify-between items-start border-b border-zinc-900/60 bg-zinc-900/40">
                                            <div className="space-y-1">
                                                <h3 className="font-black text-2xl tracking-tighter leading-tight uppercase text-indigo-100">{sl.name}</h3>
                                                <p className="text-[10px] text-zinc-600 uppercase font-black tracking-widest">{sl.songIds.length} TITRES</p>
                                            </div>
                                            <div className="flex flex-col gap-4 shrink-0">
                                                <div className="flex gap-2 justify-end">
                                                    <button onClick={() => shareSetlist(sl)} className="p-3 bg-zinc-800 rounded-xl text-indigo-500 border border-zinc-700/30 active:scale-90 transition-transform flex items-center gap-2">
                                                        <Icon name="share" size={18} color="#6366f1" />
                                                        <span className="text-[9px] font-black">PARTAGER</span>
                                                    </button>
                                                    <button onClick={() => deleteSetlist(sl.id)} className="p-3 bg-zinc-800 rounded-xl text-zinc-700 hover:text-red-500 border border-zinc-700/30 active:scale-90 transition-transform">
                                                        <Icon name="trash" size={18} />
                                                    </button>
                                                </div>
                                                <button disabled={sl.songIds.length===0} onClick={() => {setActiveSetlist(sl); setCurrentShowIndex(0); setAppState('showtime');}} className="py-3 bg-green-600 text-white rounded-2xl flex items-center justify-center gap-2 uppercase text-[10px] px-8 font-black tracking-[0.2em] disabled:opacity-10 active:scale-95 transition-transform shadow-xl uppercase">
                                                    <Icon name="play" size={16} color="white" strokeWidth={3} /> SHOW
                                                </button>
                                            </div>
                                        </div>
                                        <div className="p-6 space-y-3 max-h-96 overflow-y-auto bg-black/20">
                                            {sl.songIds.map((sid, idx) => {
                                                const song = songs.find(s => s.id === sid);
                                                return (
                                                    <div key={idx} className="flex items-center gap-4 p-4 bg-zinc-900/80 rounded-2xl border border-zinc-800/40 shadow-sm relative group">
                                                        <Icon name="grip" size={20} className="text-zinc-800 shrink-0" />
                                                        <span className="text-zinc-700 font-mono w-7 text-xs text-center font-black">{(idx+1).toString().padStart(2,'0')}</span>
                                                        <span className="flex-1 truncate uppercase font-black text-zinc-300 tracking-tight">{song?.title || "???"}</span>
                                                        <div className="flex gap-2 shrink-0">
                                                            <button onClick={() => moveInSl(sl.id, idx, idx-1)} disabled={idx===0} className="p-2 text-zinc-700 active:scale-75"><Icon name="chevronUp" size={24}/></button>
                                                            <button onClick={() => moveInSl(sl.id, idx, idx+1)} disabled={idx===sl.songIds.length-1} className="p-2 text-zinc-700 active:scale-75"><Icon name="chevronDown" size={24}/></button>
                                                            <button onClick={() => removeFromSetlist(sl.id, idx)} className="p-2 text-red-950 opacity-20 group-hover:opacity-100 active:scale-50 transition-all"><Icon name="x" size={24}/></button>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                            <div className="relative mt-4">
                                                <select className="w-full p-5 bg-zinc-950 rounded-[2rem] text-[10px] border-2 border-zinc-800/60 uppercase font-black text-zinc-500 text-center cursor-pointer tracking-[0.3em]" onChange={e => {if(e.target.value){addSongToSl(sl.id, parseFloat(e.target.value)); e.target.value=''}}} value="">
                                                    <option value="">+ AJOUTER UN TITRE EXISTANT</option>
                                                    {songs.filter(s => !sl.songIds.includes(s.id)).map(s => <option key={s.id} value={s.id}>{s.title}</option>)}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                                {setlists.length === 0 && <p className="text-center text-zinc-900 py-24 uppercase tracking-[0.5em] text-[11px] font-black opacity-20 italic">AUCUNE SETLIST CRÉÉE</p>}
                            </div>
                        )}

                        {appState === 'settings' && (
                            <div className="space-y-10 uppercase font-black">
                                <div className="flex items-center gap-6">
                                    <button onClick={() => setAppState('setlists')} className="p-4 bg-zinc-900 rounded-2xl border border-zinc-800 active:scale-90 transition-transform">
                                        <Icon name="arrowLeft" size={24} />
                                    </button>
                                    <h2 className="text-3xl tracking-tighter text-white">RÉGLAGES</h2>
                                </div>
                                <div className="space-y-6">
                                    <div className="p-6 bg-zinc-900 rounded-[2.5rem] flex justify-between items-center border border-zinc-800 shadow-xl">
                                        <div><span className="text-sm tracking-widest text-zinc-300">NUMÉROTATION</span><p className="text-[9px] text-zinc-600 font-black opacity-50">MODE SHOW TIME</p></div>
                                        <button onClick={() => setSettings({...settings, showNumbers: !settings.showNumbers})} className={`w-16 h-8 rounded-full transition-colors duration-500 ${settings.showNumbers ? 'bg-indigo-600' : 'bg-zinc-800'} relative p-1.5 shadow-inner`}><div className={`w-5 h-5 bg-white rounded-full transition-all duration-300 transform ${settings.showNumbers ? 'translate-x-8' : 'translate-x-0'} shadow-lg`} /></button>
                                    </div>
                                    <div className="p-6 bg-zinc-900 rounded-[2.5rem] flex justify-between items-center border border-zinc-800 shadow-xl">
                                        <div><span className="text-sm tracking-widest text-zinc-300">ORDRE DU SET</span><p className="text-[9px] text-zinc-600 font-black opacity-50">CROISSANT / DÉCROISSANT</p></div>
                                        <button onClick={() => setSettings({...settings, descOrder: !settings.descOrder})} className="px-6 py-3 bg-zinc-800 rounded-2xl text-[9px] font-black tracking-[0.3em] active:scale-95 transition-transform border border-zinc-700 text-white uppercase">{settings.descOrder ? 'DÉCROISSANT' : 'CROISSANT'}</button>
                                    </div>
                                    
                                    <div className="pt-10 space-y-6">
                                        <h3 className="text-lg tracking-tight px-2">LISTE DES SETLISTS</h3>
                                        <div className="space-y-3">
                                            {setlists.map(sl => (
                                                <div key={sl.id} className="p-6 bg-zinc-900/40 border border-zinc-800 rounded-3xl flex justify-between items-center">
                                                    <span className="tracking-tight truncate pr-4 text-sm">{sl.name}</span>
                                                    <span className="text-[10px] text-zinc-600 shrink-0 uppercase">{sl.songIds.length} TITRES</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="p-10 bg-red-950/10 border border-red-900/20 rounded-[3.5rem] mt-16 text-center space-y-8">
                                        <h3 className="text-red-900 tracking-[0.6em] text-[9px] opacity-40 uppercase font-black">ZONE CRITIQUE</h3>
                                        <button onClick={() => setModal({type:'confirmDelete'})} className="w-full py-6 bg-red-900 text-white rounded-[2.5rem] font-black text-sm active:scale-95 transition-all uppercase shadow-2xl shadow-red-900/40">EFFACER TOUT</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                    <footer className="mt-auto border-t border-zinc-900/30 pb-safe bg-black">
                        <Signature />
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>